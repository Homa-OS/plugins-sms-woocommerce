# راهنمای دیباگ افزونه پیامک ووکامرس

## ویژگی‌های جدید دیباگ

### 1. پیام‌های تفصیلی در تب "ارسال پیامک"

پس از فشردن دکمه "ارسال پیامک"، اطلاعات کاملی نمایش داده می‌شود:

#### در صورت موفقیت:
- ✅ زمان دقیق ارسال
- 🔧 نام و کلاس درگاه پیامک
- 📱 تعداد شماره‌های ورودی و معتبر
- 📋 لیست شماره‌های دریافت کننده
- 📝 طول متن پیامک
- ✅ وضعیت موفقیت API

#### در صورت خطا:
- ❌ جزئیات کامل خطا
- 🔧 اطلاعات درگاه استفاده شده
- 📱 شماره‌های پردازش شده
- 📊 نوع پاسخ API
- 📋 پاسخ کامل وبسرویس
- 💡 راهنمای عیب‌یابی

### 2. لاگ‌های WP_DEBUG

برای فعال‌سازی لاگ‌های تفصیلی در `wp-config.php` اضافه کنید:

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

لاگ‌ها در فایل `/wp-content/debug.log` ذخیره می‌شوند.

### 3. بهبودی‌های کلاس Homa

کلاس Homa حالا اطلاعات تفصیلی برمی‌گرداند:

#### پاسخ موفق:
```php
return true; // برای موفقیت کامل
```

#### پاسخ خطا:
```php
return [
    'status' => 'error',
    'message' => 'توضیح خطا',
    'errors' => [...], // جزئیات خطاها
    'successes' => [...], // ارسال‌های موفق
    'summary' => [...], // خلاصه آمار
    'gateway' => [...] // اطلاعات درگاه
];
```

### 4. کدهای خطای Homa API

| کد | توضیح |
|----|-------|
| 0 | خطای عمومی |
| 1 | نام کاربری یا رمز عبور اشتباه |
| 2 | اعتبار کافی نیست |
| 3 | شماره فرستنده معتبر نیست |
| 4 | شماره گیرنده معتبر نیست |
| 5 | متن پیامک خالی است |
| 6 | متن پیامک طولانی است |
| 8 | کاربر غیرفعال |
| 15 | متن حاوی کلمات فیلتر شده |
| 16 | کاربر مسدود شده |

### 5. نکات عیب‌یابی

1. **بررسی اطلاعات وبسرویس**: نام کاربری، رمز عبور، شماره فرستنده
2. **بررسی اعتبار**: مطمئن شوید حساب شما اعتبار کافی دارد
3. **بررسی شماره فرستنده**: شماره باید فعال و معتبر باشد
4. **بررسی زمان ارسال**: برخی سرویس‌ها محدودیت زمانی دارند
5. **بررسی متن**: متن نباید حاوی کلمات فیلتر شده باشد

### 6. استفاده از آرشیو پیامک‌ها

تمام ارسال‌ها (موفق و ناموفق) در آرشیو ذخیره می‌شوند و شامل:
- جزئیات کامل ارسال
- زمان دقیق
- نتیجه API
- اطلاعات درگاه استفاده شده

### 7. مثال خروجی دیباگ

```json
{
  "timestamp": "2024-01-01 12:30:45",
  "gateway_class": "PW\\PWSMS\\Gateways\\Homa",
  "gateway_name": "Homais.com",
  "gateway_id": "Homa",
  "mobile_count": 1,
  "message_length": 25,
  "username": "usr***",
  "sender_number": "50004001",
  "send_duration": "1250.5ms",
  "result_type": "array",
  "result_is_success": false,
  "error_details": "جزئیات خطا..."
}
```

این ویژگی‌ها به شما کمک می‌کنند مشکلات ارسال پیامک را سریع‌تر تشخیص دهید و رفع کنید. 